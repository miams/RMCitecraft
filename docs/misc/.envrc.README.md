# direnv Configuration

This project uses [direnv](https://direnv.net/) to automatically manage the development environment.

## What `.envrc` Does

When you `cd` into this project directory, direnv automatically:

1. **Activates the Python virtual environment** (`.venv/`)
2. **Loads environment variables** from `.env` (project root)
3. **Applies user-specific overrides** from `.envrc.local` (if it exists)

## Setup

### First Time Setup

```bash
# Install direnv
brew install direnv

# Add direnv hook to your shell (~/.zshrc or ~/.bashrc)
echo 'eval "$(direnv hook zsh)"' >> ~/.zshrc
source ~/.zshrc

# Allow direnv for this project (required once)
cd /path/to/RMCitecraft
direnv allow
```

### Verify It's Working

```bash
# Leave and re-enter the project directory
cd ..
cd RMCitecraft

# You should see:
# direnv: loading ~/Code/RMCitecraft/.envrc
# direnv: export +ANTHROPIC_API_KEY +DEFAULT_LLM_PROVIDER ...

# Verify environment is activated
which python
# Should show: /Users/miams/Code/RMCitecraft/.venv/bin/python

# Verify env vars are loaded
echo $DEFAULT_LLM_PROVIDER
# Should show: anthropic (or whatever you configured)
```

## Configuration Files

### `.env` (project root)
Primary configuration file for the application. Contains:
- LLM API keys and settings
- Database paths
- Logging configuration
- Output directories

**Never commit this file** - it contains secrets.

**Template**: Copy from `config/.env.example` to `.env` in project root.

### `.envrc.local` (optional)
User-specific overrides (gitignored). Use this for:
- Developer-specific settings
- Local path overrides
- Temporary environment variables

Example `.envrc.local`:
```bash
# Override default LLM provider for local development
export DEFAULT_LLM_PROVIDER=ollama

# Use local database for testing
export RM_DATABASE_PATH=/Users/myname/test.rmtree

# Enable debug logging
export LOG_LEVEL=DEBUG
```

## Benefits Over Manual Activation

**Before (manual):**
```bash
cd RMCitecraft
source .venv/bin/activate
export ANTHROPIC_API_KEY=sk-ant-...
export DEFAULT_LLM_PROVIDER=anthropic
# ... repeat every time you open a new terminal
```

**After (with direnv):**
```bash
cd RMCitecraft
# Everything is ready! Virtual env activated, env vars loaded.
```

## Troubleshooting

### "direnv: error .envrc is blocked"
Run `direnv allow` to authorize the configuration.

### Environment variables not loading
```bash
# Reload direnv
direnv reload

# Check what direnv sees
direnv status

# Verify .env exists in project root
ls -la .env
```

### Changes to .env not reflected
```bash
# Reload direnv after editing .env files
direnv reload

# Or just cd out and back in
cd .. && cd RMCitecraft
```

## Security Notes

- `.envrc` is **committed to git** (shared configuration)
- `.env` is **gitignored** (contains secrets)
- `.envrc.local` is **gitignored** (personal overrides)
- direnv prompts before loading any `.envrc` file (safety feature)

## Disabling direnv (if needed)

```bash
# Temporarily disable for this project
direnv deny

# Re-enable
direnv allow

# Uninstall direnv entirely
brew uninstall direnv
# Remove hook from ~/.zshrc
```

## Resources

- [direnv documentation](https://direnv.net/)
- [direnv stdlib reference](https://direnv.net/man/direnv-stdlib.1.html)
- Project docs: `CLAUDE.md` and `AGENTS.md`
